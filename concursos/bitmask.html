<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
  <meta name="description" content="How to use bitmasks">
  <title>Bitmasks</title>
</head>

<body>

<h1 style="text-align: center;">Bitmasks</h1>
<center><span style="font-size: small;"><em>João Pedro Neto</em></span></center>

<p>Uma bitmask é o uso de variáveis inteiras como conjuntos de booleanos.</p>
<p>A vantagem está na poupança de memória (apenas 1 bit por elemento) e na extrema rapidez das operações. Estas duas características são ideais para usar nos concursos.</p>
<p>A maior parte dos excertos de código são da secção 2.2 do livro do Halim, mas juntei alguns outros e um exemplo mais completo.</p>
<p>No Java temos quatro tipos de inteiros</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #000080; font-weight: bold;">byte  </span>b  = <span style="color: #0000ff;">36</span>;  <span style="color: #808080; font-style: italic;">//  8 bits<br /></span><span style="color: #000080; font-weight: bold;">short </span>s  = <span style="color: #0000ff;">36</span>;  <span style="color: #808080; font-style: italic;">// 16 bits<br /></span><span style="color: #000080; font-weight: bold;">int   </span>i  = <span style="color: #0000ff;">36</span>;  <span style="color: #808080; font-style: italic;">// 32 bits<br /></span><span style="color: #000080; font-weight: bold;">long  </span>lg = <span style="color: #0000ff;">36L</span>; <span style="color: #808080; font-style: italic;">// 64 bits</span></span></pre>
<p>que podemos usar consoante as nossas necessidades.</p>
<p>O Java fornece vários operadores para lidar com bits. Dois deles fazer shift de bits para a esquerda (&lt;&lt;) e para a direita (&gt;&gt;) que correspondem a multiplicações e divisões inteiras por potências de dois.</p>
<p>Alguns exemplos:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #808080; font-style: italic;">// Multiply by a power of 2<br /></span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d * 4 = %d</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, b, b&lt;&lt;<span style="color: #0000ff;">2</span>);</span><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">// Divide by a power of 2<br /></span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d / 4 = %d</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, s, s&gt;&gt;<span style="color: #0000ff;">2</span>);</span><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">// Multiply by 10: 10x = 8x + 2x<br /></span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d * 10 = %d</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, i, (i&lt;&lt;<span style="color: #0000ff;">3</span>) + (i&lt;&lt;<span style="color: #0000ff;">1</span>));</span><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">// Multiply by 3.5: 3.5x = (8x-x)/2<br /></span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d * 3.5 = %d</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, lg, ((lg&lt;&lt;<span style="color: #0000ff;">3</span>)-lg)&gt;&gt;<span style="color: #0000ff;">1</span>);<br /></span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #808080; font-style: italic;">36 * 4 = 144<br />36 / 4 = 9<br />36 * 10 = 360<br />36 * 3.5 = 126</span></span></pre>
<p>Podemos comparar a velocidade entre o uso destas operações e os operadores normais:</p>
<pre style="margin-left: 30px;"><span style="font-size: small;">long startTime = System.currentTimeMillis();<br /></span><span style="font-size: small;">long total = 0;<br /></span><span style="font-size: small;">for (int k = 0; k &lt; 5000000; k++)<br /></span><span style="font-size: small;">    total = k*10;<br /></span><span style="font-size: small;">System.out.println("Time Elapsed: " + (System.currentTimeMillis() - startTime) + "ms");</span></pre>
<pre style="margin-left: 30px;"><span style="font-size: small;"></span></pre>
<pre style="margin-left: 30px;"><em><span style="font-size: small;">Time Elapsed: 11ms</span></em></pre>
<pre style="margin-left: 30px;"><span style="font-size: small;"><br />startTime = System.currentTimeMillis();</span><br /><span style="font-size: small;">total = 0;</span><br /><span style="font-size: small;">for (int k = 0; k &lt; 5000000; k++)</span><br /><span style="font-size: small;"> total = (k&lt;&lt;3) + (k&lt;&lt;1);<br /></span><span style="font-size: small;">System.out.println("Time Elapsed: " + (System.currentTimeMillis() - startTime) + "ms");<br /></span></pre>
<pre><span style="font-size: small;"><em>    Time Elapsed: 8ms</em></span></pre>
<p>O Java também possui operadores lógicos bit a bit, o not (~), o and (&amp;), o or (|) e o xor (^):</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #808080; font-style: italic;">// ~ -- bitwise NOT<br /></span><span style="color: #000080; font-weight: bold;">short </span>s1 = <span style="color: #0000ff;">7</span>;</span><br /><span style="font-size: small;">System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"~%d = %d</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, s1, ~s1);  <span style="color: #808080; font-style: italic;">// 00000111 =&gt; 11111000 (first bit == sign)<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">// &amp; -- bitwise AND<br /></span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d &amp; %d = %d</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, <span style="color: #0000ff;">7</span>, <span style="color: #0000ff;">3</span>, <span style="color: #0000ff;">7</span>&amp;<span style="color: #0000ff;">3</span>);</span><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">// | -- bitwise OR<br /></span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d | %d = %d</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, <span style="color: #0000ff;">7</span>, <span style="color: #0000ff;">3</span>, <span style="color: #0000ff;">7</span>|<span style="color: #0000ff;">3</span>);</span><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">// ^ -- bitwise XOR<br /></span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d ^ %d = %d</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, <span style="color: #0000ff;">7</span>, <span style="color: #0000ff;">3</span>, <span style="color: #0000ff;">7</span>^<span style="color: #0000ff;">3</span>);</span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="color: #808080; font-style: italic; font-size: small;">~7 = -8<br />7 &amp; 3 = 3<br />7 | 3 = 7<br />7 ^ 3 = 4</span></pre>
<p>Com estes operadores podemos manipular determinados bits, sem mudar os restantes:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #808080; font-style: italic;">//turn on a specific bit (starts at index 0)<br /></span><span style="color: #000080; font-weight: bold;">int </span>bit=<span style="color: #0000ff;">3</span>;</span><br /><span style="font-size: small;">System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%s with %dth bit on is %s</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>,</span><br /><span style="font-size: small;">                  Integer.<span style="font-style: italic;">toBinaryString</span>(s), bit+<span style="color: #0000ff;">1</span>, Integer.<span style="font-style: italic;">toBinaryString</span>(  s|(<span style="color: #0000ff;">1</span>&lt;&lt;bit)  ));</span><br /><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">//turn off a specific bit (starts at index 0)<br /></span>bit=<span style="color: #0000ff;">2</span>;</span><br /><span style="font-size: small;">System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%s with %dth bit off is %s</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>,</span><br /><span style="font-size: small;">                  Integer.<span style="font-style: italic;">toBinaryString</span>(s), bit+<span style="color: #0000ff;">1</span>, Integer.<span style="font-style: italic;">toBinaryString</span>(  s&amp;~(<span style="color: #0000ff;">1</span>&lt;&lt;bit)  ));</span><br /><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">//check if a certain bit is on (starts at index 0)<br /></span>bit=<span style="color: #0000ff;">2</span>;</span><br /><span style="font-size: small;">System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"Has %s the %dth bit on? %s</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>,</span><br /><span style="font-size: small;">                  Integer.<span style="font-style: italic;">toBinaryString</span>(s), bit+<span style="color: #0000ff;">1</span>, (s&amp;(<span style="color: #0000ff;">1</span>&lt;&lt;bit))!=<span style="color: #0000ff;">0  </span>);<br /></span><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">//flip a certain bit (starts at index 0)<br /></span>bit=<span style="color: #0000ff;">2</span>;</span><br /><span style="font-size: small;">System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%s with the %dth flipped is %s</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>,</span><br /><span style="font-size: small;">                  Integer.<span style="font-style: italic;">toBinaryString</span>(s), bit+<span style="color: #0000ff;">1</span>, Integer.<span style="font-style: italic;">toBinaryString</span>(  s^(<span style="color: #0000ff;">1</span>&lt;&lt;bit)  ));<br /></span><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">//get least significant bit == 1 (starts at index 0)<br /></span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"least significant bit of %s at bit %s</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>,</span><br /><span style="font-size: small;">                  Integer.<span style="font-style: italic;">toBinaryString</span>(s), s&amp;-s );</span><br /><br /><span style="font-size: small;"><span style="color: #808080; font-style: italic;">100100 with 4th bit on is 101100<br />100100 with 3th bit off is 100000<br />Has 100100 the 3th bit on? true<br />100100 with the 3th flipped is 100000<br />least significant bit of 100100 at bit 4</span></span></pre>
<p>Outras operações avulsas (ver mais <a href="http://graphics.stanford.edu/~seander/bithacks.html" target="_blank">aqui</a>)</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; font-size: 9,0pt;"><span style="font-size: small;"><span style="color: #808080; font-style: italic;">    // check if integers have opposite signs<br /></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">short </span>x=<span style="color: #0000ff;">3</span>, y=-<span style="color: #0000ff;">3</span>;</span><br /><span style="font-size: small;">    System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d has opposite sign of %d? %s</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, x, y, (x^y)&lt;<span style="color: #0000ff;">0 </span>);<br /><span style="color: #808080; font-style: italic;">    3 has opposite sign of -3? true</span></span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><br /></span><span style="font-size: small;"> <span style="color: #808080; font-style: italic;">///////////////////////////////////////<br /> // check if value is 2^x (includes zero)<br /></span><span style="color: #808080; font-style: italic;"> </span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d is a power of 2? %s</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, x, (x&amp;(x-<span style="color: #0000ff;">1</span>)) == <span style="color: #0000ff;">0 </span>); <br /> <span style="font-size: small;"><span style="color: #808080; font-style: italic;">3 is a power of 2? false</span></span></span><br /><br /><span style="font-size: small;"> <span style="font-size: small;"><span style="color: #808080; font-style: italic;">///////////////////////////////////////</span></span><br /> <span style="color: #808080; font-style: italic;">// counting bits<br /></span><span style="color: #808080; font-style: italic;"> </span><span style="color: #000080; font-weight: bold;">int </span>c,x1=x; <span style="color: #000080; font-weight: bold;">for</span>(c=<span style="color: #0000ff;">0</span>; x1!=<span style="color: #0000ff;">0</span>; x1&gt;&gt;=<span style="color: #0000ff;">1</span>) c += x1 &amp; <span style="color: #0000ff;">1</span>;</span><br /><span style="font-size: small;"> System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%d has %d bits 1</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, x, c );<br /><span style="color: #808080; font-style: italic;"> 3 has 2 bits 1<br /></span></span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 60px;"><span style="font-size: small;"></span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #808080; font-style: italic;"> <span style="font-size: small;"><span style="color: #808080; font-style: italic;">///////////////////////////////////////</span></span><br /> // get the next power of 2 (for integers, 32 bits)</span></span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 60px;"><br /><span style="font-size: small;"><span style="color: #000080; font-weight: bold;">static int </span>nextPower(<span style="color: #000080; font-weight: bold;">int </span>v) {</span><br /><span style="font-size: small;"> v--; v |= v &gt;&gt; <span style="color: #0000ff;">1</span>; v |= v &gt;&gt; <span style="color: #0000ff;">2</span>; v |= v &gt;&gt; <span style="color: #0000ff;">4</span>; v |= v &gt;&gt; <span style="color: #0000ff;">8</span>; v |= v &gt;&gt; <span style="color: #0000ff;">16</span>;</span><br /><span style="font-size: small;"> <span style="color: #000080; font-weight: bold;">return </span>++v;</span><br /><span style="font-size: small;">}</span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"> <span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;"> </span><span style="color: #000080; font-weight: bold;">int </span>v=<span style="color: #0000ff;">1034</span>;</span><br /><span style="font-size: small;"> System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"next power of 2 of %d is %d</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>, v, <span style="font-style: italic;">nextPower</span>(v));<br /> <span style="font-size: small;"><span style="color: #808080; font-style: italic;">next power of 2 of 1034 is 2048<br /></span></span></span><br /><br /><span style="font-size: small;"> <span style="font-size: small;"><span style="color: #808080; font-style: italic;">///////////////////////////////////////</span></span><br /><span style="color: #808080; font-style: italic;"> // compute next lexicographic permutation, maintaining the number of bits 1<br /></span><span style="color: #808080; font-style: italic;"> </span>v = <span style="color: #0000ff;">19</span>;</span><br /><span style="font-size: small;"> System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"next permutation of %s is %s</span><span style="color: #000080; font-weight: bold;">\n</span><span style="color: #008000; font-weight: bold;">"</span>,</span><br /><span style="font-size: small;">                   Integer.<span style="font-style: italic;">toBinaryString</span>(v),</span><br /><span style="font-size: small;">                   Integer.<span style="font-style: italic;">toBinaryString</span>(<span style="font-style: italic;">nextBitPermutation</span>(v)));<br /> <span style="color: #808080; font-style: italic;">next permutation of 10011 is 10101</span></span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #808080; font-style: italic;"> <br /> <span style="font-size: small;"><span style="color: #808080; font-style: italic;">///////////////////////////////////////</span></span><br /> // compute next grey code, ie, a representation where two successive values differ in only one bit<br /></span><span style="color: #808080; font-style: italic;"> // eg for 4 bits: 0000-&gt;0001-&gt;0011-&gt;0010-&gt;0110-&gt;0111 ...</span></span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 60px;"><span style="font-size: small;"><span style="color: #808080; font-style: italic;">// number of bits 1 is invariant<br /></span><span style="color: #000080; font-weight: bold;">static int </span>nextBitPermutation(<span style="color: #000080; font-weight: bold;">int </span>v) {</span><br /><span style="font-size: small;"> <span style="color: #000080; font-weight: bold;">int </span>t = (v | (v - <span style="color: #0000ff;">1</span>)) + <span style="color: #0000ff;">1</span>;</span><br /><span style="font-size: small;"> <span style="color: #000080; font-weight: bold;">return </span>t | ((((t &amp; -t) / (v &amp; -v)) &gt;&gt; <span style="color: #0000ff;">1</span>) - <span style="color: #0000ff;">1</span>);</span><br /><span style="font-size: small;">}</span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><br /><span style="font-size: small;"> <span style="color: #808080; font-style: italic;"></span>IntStream.<span style="font-style: italic;">range</span>(<span style="color: #0000ff;">1</span>,<span style="color: #0000ff;">15</span>)</span><span style="font-size: small;">.forEach(n -&gt; System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.printf(<span style="color: #008000; font-weight: bold;">"%s -&gt; "</span>, Integer.<span style="font-style: italic;">toBinaryString</span>(<span style="font-style: italic;">grey</span>(n)) ));</span><br /><span style="font-size: small;"> System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.println(<span style="color: #008000; font-weight: bold;">"..."</span>);<br /> <span style="font-size: small;"><span style="color: #808080; font-style: italic;">0 -&gt; 1 -&gt; 11 -&gt; 10 -&gt; 110 -&gt; 111 -&gt; 101 -&gt; 100 -&gt; 1100 -&gt; 1101 -&gt; 1111 -&gt; 1110 -&gt; 1010 -&gt; 1011 -&gt; ...</span></span></span></pre>
<hr />
<p>Vejamos um exemplo de uso (<a href="http://www.geeksforgeeks.org/bitmasking-and-dynamic-programming-set-1-count-ways-to-assign-unique-cap-to-every-person/" target="_blank">ref</a>).</p>
<p>Seja o seguinte problema: há n pessoas (n&lt;=10) que possuem diferentes chapéus (há 100 tipos diferentes). Queremos saber de quantas formas diferentes podemos atribuir um chapéu a cada pessoa de forma a que nenhum par de pessoas use o mesmo tipo de chapéu. Por exemplo, seja esta instância de problema:</p>
<pre><span style="font-size: small;">3
5 100 1    
2           
5 100 </span> </pre>
<p>ou seja, há três pessoas, a 1ª tem chapéus do tipo 1, 5 e 100, a 2ª tem apenas um chapéu de tipo 2 e a 3ª pessoa tem chapéus do tipo 5 e 100.</p>
<p>Nesta instância há quatro soluções diferentes:  as atribuições (5, 2, 100),  (100, 2, 5), (1, 2, 5) e (1, 2, 100).</p>
<p>Como este número pode crescer imenso, pede-se para devolver o valor total módulo 1000000007.</p>
<p>Este é um problema onde temos de verificar todos os subconjuntos de atribuições de chapéus pelas n pessoas.</p>
<p>A nossa matriz de soluções <span style="font-family: courier new,courier,monospace;">sols[i][j]</span> vai representar o seguinte: i corresponde ao conjunto de pessoas que estão a usar chapéu e j representa quantos tipos de chapéus já foram usados (dos tipos 1 a j). Vamos guardar estes valores porque caso contrário eles seriam calculados repetidamente.</p>
<p>A primeira dimensão da matriz é complexa, representa um conjunto de valores booleanos que guardam respostas como 'a i-ésima pessoa está a usar chapéu?'. Para tal vamos usar um bitmask que pode ter até 10 bits (o número máximo de pessoas). Ou seja, teremos 2^10 = 1024 sub-conjuntos possíveis. Isto significa que a primeira dimensão está a indexar a um conjunto de booleanos! Esta é uma das vantagens dos <em>bitmasks</em>.</p>
<p>Reparem que não sabemos exactamente quem está a usar qual chapéu (isso não é pedido no enunciado) apenas sabemos que todos os chapéus de índices 1 a j já não podem ser escolhidos nos cálculos adiante.</p>
<p>Este é o início da classe:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #000080; font-weight: bold;">public class </span>UniqueCaps {</span><br /><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">static final int </span><span style="color: #660e7a; font-weight: bold; font-style: italic;">TOTAL_CAPS </span>= <span style="color: #0000ff;">101</span>;</span><br /><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">static final long </span><span style="color: #660e7a; font-weight: bold; font-style: italic;">MOD </span>= <span style="color: #0000ff;">1_000_000_007</span>;</span><br /><span style="font-size: small;">    <span style="color: #808080; font-style: italic;">// define array caps where we keep who can wear cap i<br /></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static </span>List&lt;Integer&gt;[] <span style="color: #660e7a; font-style: italic;">caps</span>;</span><br /><span style="font-size: small;">    <span style="color: #808080; font-style: italic;">// In sols[i][j], i denotes the bitmask, ie, who are wearing caps<br /></span><span style="color: #808080; font-style: italic;">    // and j denotes the number of caps 1 to j used so far,<br /></span><span style="color: #808080; font-style: italic;">    // with the restriction that no one is wearing the same cap<br /></span><span style="color: #808080; font-style: italic;">    // There are up to 10 persons (2^10 = 1024) and 100 caps<br /></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static long</span>[][] <span style="color: #660e7a; font-style: italic;">sols</span>;</span><br /><span style="font-size: small;">    <span style="color: #808080; font-style: italic;">// init data structures<br /></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static </span>{</span><br /><span style="font-size: small;">        <span style="color: #660e7a; font-style: italic;">caps </span>= <span style="color: #000080; font-weight: bold;">new </span>List[<span style="color: #660e7a; font-weight: bold; font-style: italic;">TOTAL_CAPS</span>];</span><br /><span style="font-size: small;">        <span style="color: #000080; font-weight: bold;">for</span>(<span style="color: #000080; font-weight: bold;">int </span>i=<span style="color: #0000ff;">1</span>; i&lt;<span style="color: #660e7a; font-weight: bold; font-style: italic;">TOTAL_CAPS</span>; i++)</span><br /><span style="font-size: small;">            <span style="color: #660e7a; font-style: italic;">caps</span>[i] = <span style="color: #000080; font-weight: bold;">new </span>LinkedList&lt;Integer&gt;();</span><br /><span style="font-size: small;">        <span style="color: #660e7a; font-style: italic;">sols </span>= <span style="color: #000080; font-weight: bold;">new long</span>[<span style="color: #0000ff;">1025</span>][<span style="color: #660e7a; font-weight: bold; font-style: italic;">TOTAL_CAPS</span>]; <span style="color: #808080; font-style: italic;">// let's start indexes at 1<br /></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #000080; font-weight: bold;">for</span>(<span style="color: #000080; font-weight: bold;">int </span>i=<span style="color: #0000ff;">0</span>; i&lt;<span style="color: #0000ff;">1025</span>; i++)</span><br /><span style="font-size: small;">            <span style="color: #000080; font-weight: bold;">for</span>(<span style="color: #000080; font-weight: bold;">int </span>j=<span style="color: #0000ff;">0</span>; j&lt;<span style="color: #660e7a; font-weight: bold; font-style: italic;">TOTAL_CAPS</span>; j++)</span><br /><span style="font-size: small;">                <span style="color: #660e7a; font-style: italic;">sols</span>[i][j] = -<span style="color: #0000ff;">1L</span>;</span><br /><span style="font-size: small;">    }<br /><span style="color: #000080; font-weight: bold;">    static int </span><span style="color: #660e7a; font-style: italic;">allmask</span>; <span style="color: #808080; font-style: italic;">// all are wearing caps, ie, all bits are set to 1</span></span></pre>
<p>A ideia principal para calcular as soluções é a seguinte: <span style="font-family: courier new,courier,monospace;">solve(int bitmask, int i)</span> significa que dado o conjunto de atribuições corrente (<span style="font-family: courier new,courier,monospace;">bitmask</span>) queremos tratar o chapéu de tipo <span style="font-family: courier new,courier,monospace;">i</span> (assumindo que já tratamos os chapéus de tipo 1 a <span style="font-family: courier new,courier,monospace;">i-1</span>).</p>
<p>Para tal, se todas as pessoas já têm chapéus, já temos uma solução. Senão, há que considerar as seguintes hipóteses:</p>
<ul>
<li>Vamos ver quantas soluções há se não atribuirmos este chapéu</li>
<li>Vamos ver quantas soluções há se atribuirmos este chapéu a cada uma das pessoas que o tem</li>
</ul>
<p>O resultado será a soma de todas estas respostas.</p>
<p>Vejamos a implementação do método <span style="font-family: courier new,courier,monospace;">solve</span>:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #808080; font-style: italic;">// bitmask is the set of persons in consideration<br /></span><span style="color: #808080; font-style: italic;">// the caps are already processed from 1 to i-1<br /></span><span style="color: #808080; font-style: italic;">// complexity O(2^nPersons * TOTAL_CAPS)<br /></span><span style="color: #000080; font-weight: bold;">private static long </span>solve(<span style="color: #000080; font-weight: bold;">int </span>bitmask, <span style="color: #000080; font-weight: bold;">int </span>i) {</span><br /><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">if </span>(<span style="color: #660e7a; font-style: italic;">allmask </span>== bitmask)  <span style="color: #808080; font-style: italic;">// all persons are using caps, we are done<br /></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #000080; font-weight: bold;">return </span><span style="color: #0000ff;">1</span>;</span><br /><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">if </span>(i&gt;=<span style="color: #660e7a; font-weight: bold; font-style: italic;">TOTAL_CAPS</span>) <span style="color: #808080; font-style: italic;">// not all are wearing caps, but no caps left<br /></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #000080; font-weight: bold;">return </span><span style="color: #0000ff;">0</span>;      <span style="color: #808080; font-style: italic;">// so, no solution was found<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">if </span>(<span style="color: #660e7a; font-style: italic;">sols</span>[bitmask][i] != -<span style="color: #0000ff;">1</span>)      <span style="color: #808080; font-style: italic;">// solution already found<br /></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #000080; font-weight: bold;">return </span><span style="color: #660e7a; font-style: italic;">sols</span>[bitmask][i];</span><br /><span style="font-size: small;">    <span style="color: #808080; font-style: italic;">// if we don't include this cap, how many solutions are there?<br /></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">long </span>nSols = <span style="font-style: italic;">solve</span>(bitmask, i+<span style="color: #0000ff;">1</span>);</span><br /><span style="font-size: small;">    <span style="color: #808080; font-style: italic;">// assign cap i to every person that has it<br /></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">for</span>(<span style="color: #000080; font-weight: bold;">int </span>person : <span style="color: #660e7a; font-style: italic;">caps</span>[i]) {</span><br /><span style="font-size: small;">        <span style="color: #808080; font-style: italic;">// if this person is already wearing a cap, go to next one<br /></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #000080; font-weight: bold;">if </span>((bitmask &amp; (<span style="color: #0000ff;">1 </span>&lt;&lt; (person-<span style="color: #0000ff;">1</span>))) != <span style="color: #0000ff;">0</span>)</span><br /><span style="font-size: small;">            <span style="color: #000080; font-weight: bold;">continue</span>;</span><br /><span style="font-size: small;">        <span style="color: #808080; font-style: italic;">// otherwise, assign it, and solve for the remaining caps<br /></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #000080; font-weight: bold;">int </span>newBitmask = bitmask | (<span style="color: #0000ff;">1 </span>&lt;&lt; (person-<span style="color: #0000ff;">1</span>));</span><br /><span style="font-size: small;">        nSols += <span style="font-style: italic;">solve</span>(newBitmask, i+<span style="color: #0000ff;">1</span>);</span><br /><span style="font-size: small;">        nSols %= <span style="color: #660e7a; font-weight: bold; font-style: italic;">MOD</span>;</span><br /><span style="font-size: small;">    }</span><br /><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">return </span><span style="color: #660e7a; font-style: italic;">sols</span>[bitmask][i] = nSols;</span><br /><span style="font-size: small;">}</span></pre>
<p>O que sobra é ler o <em>input </em>e invocar o <span style="font-family: courier new,courier,monospace;">solve</span>:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">public static void </span>main(String[] args) {</span><br /><span style="font-size: small;">        <span style="color: #000080; font-weight: bold;">if </span>(!<span style="color: #000080; font-weight: bold;">new </span>Object(){}.getClass().getName().contains(<span style="color: #008000; font-weight: bold;">"Main"</span>))</span><br /><span style="font-size: small;">            <span style="color: #808080; font-style: italic;">// if true: read from files; else: read from System.in<br /></span><span style="color: #808080; font-style: italic;">            </span><span style="color: #000080; font-weight: bold;">try </span>{</span><br /><span style="font-size: small;">                System.<span style="font-style: italic;">setIn </span>(<span style="color: #000080; font-weight: bold;">new </span>FileInputStream(<span style="color: #008000; font-weight: bold;">"data/uniquecaps.in.txt" </span>));</span><br /><span style="font-size: small;">                System.<span style="font-style: italic;">setOut</span>(<span style="color: #000080; font-weight: bold;">new </span>PrintStream(<span style="color: #008000; font-weight: bold;">"data/uniquecaps.out.txt"</span>) );</span><br /><span style="font-size: small;">            } <span style="color: #000080; font-weight: bold;">catch </span>(Exception e) {}</span><br /><span style="font-size: small;">        <span style="color: #808080; font-style: italic;">///////////////////////<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">        </span>Scanner sc = <span style="color: #000080; font-weight: bold;">new </span>Scanner(System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">in</span>);</span><br /><span style="font-size: small;">        <span style="color: #000080; font-weight: bold;">int </span>nPersons = sc.nextInt();</span><br /><span style="font-size: small;">        <span style="color: #808080; font-style: italic;">// read caps<br /></span><span style="color: #808080; font-style: italic;">        </span>sc.nextLine(); <span style="color: #808080; font-style: italic;">// consume first newline<br /></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #000080; font-weight: bold;">for</span>(<span style="color: #000080; font-weight: bold;">int </span>person=<span style="color: #0000ff;">1</span>; person&lt;=nPersons; person++) {</span><br /><span style="font-size: small;">            <span style="color: #000080; font-weight: bold;">int</span>[] caps_i = Arrays.<span style="font-style: italic;">stream</span>(sc.nextLine().split(<span style="color: #008000; font-weight: bold;">" "</span>))</span><br /><span style="font-size: small;">                                 .mapToInt(Integer::<span style="font-style: italic;">parseInt</span>)</span><br /><span style="font-size: small;">                                 .toArray();</span><br /><span style="font-size: small;">            <span style="color: #000080; font-weight: bold;">for</span>(<span style="color: #000080; font-weight: bold;">int </span>cap : caps_i)</span><br /><span style="font-size: small;">                <span style="color: #660e7a; font-style: italic;">caps</span>[cap].add(person);</span><br /><span style="font-size: small;">        }</span><br /><span style="font-size: small;">        <span style="color: #660e7a; font-style: italic;">allmask  </span>= (<span style="color: #0000ff;">1</span>&lt;&lt;nPersons) - <span style="color: #0000ff;">1</span>; <span style="color: #808080; font-style: italic;">// set bits to 1<br /></span><span style="color: #808080; font-style: italic;">        </span>System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.println( <span style="font-style: italic;">solve</span>(<span style="color: #0000ff;">0</span>,<span style="color: #0000ff;">1</span>) );</span><br /><span style="font-size: small;">    }<br /></span><br /><span style="font-size: small;">} <span style="font-size: small;"><span style="color: #808080; font-style: italic;">// end class</span></span></span></pre>
<p></p>
<hr />
<p>Para consolidar esta matéria, resolvam o <a href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=3077" target="_blank">UVa 11926</a> usando um <em>bitmask</em> com 1 milhão de bits.</p>
<p></p></div></div><div class="modified">Last modified: Wednesday, 23 November 2016, 10:05 AM</div></div>

</body>
</html>