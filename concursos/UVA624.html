<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
  <meta name="description" content="backtracking search">
  <title>UVa 624 - Retrocesso</title>
</head>

<body>

<h1 style="text-align: center;">UVa 624 - CD</h1>
<center><span style="font-size: small;"><em>João Pedro Neto</em></span></center>

 <p>Leiam o <a href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;category=&amp;problem=565">enunciado do problema</a>.</p>
 
<p>É-nos pedido, de entre todas as combinações possíveis de escolhas de músicas (há no máximo 20 músicas), aquelas que maximizam a duração total sem ultrapassar um dado N.</p>

<p>Não teríamos tempo para testar à força bruta todas as combinações possíveis, portanto temos de ser mais eficientes na construção de soluções.</p>

<p>Este é um problema onde é possível construir soluções parciais, e onde é possível verificar se estas soluções são ainda viáveis (deixam de ser quando a soma ultrapassar N). Ou seja, este é um problema que pode ser atacado por <em>backtracking</em>.</p>

<p>Vamos definir uma classe para resolver este problema e introduzir um conjunto de atributos que serão necessários:</p>

<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #000080; font-weight: bold;">public class </span>UVa_624_CD {</span><br><br><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">static final int </span><span style="color: #660e7a; font-weight: bold; font-style: italic;">NTA </span>= -<span style="color: #0000ff;">1</span>;      <span style="color: #808080; font-style: italic;">// means No Track Available<br></span><span style="color: #808080; font-style: italic;"><br></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static int   </span><span style="color: #660e7a; font-style: italic;">N</span>;                 <span style="color: #808080; font-style: italic;">// the tape capacity in minutes<br></span><span style="color: #808080; font-style: italic;"><br></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static int   </span><span style="color: #660e7a; font-style: italic;">n_tracks</span>;          <span style="color: #808080; font-style: italic;">// the number of tracks at a given problem instance<br></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static int</span>[] <span style="color: #660e7a; font-style: italic;">tracks_length</span>;     <span style="color: #808080; font-style: italic;">// each track's length (in minutes)<br></span><span style="color: #808080; font-style: italic;"><br></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static int</span>[] <span style="color: #660e7a; font-style: italic;">current</span>;           <span style="color: #808080; font-style: italic;">// keeps the current chosen tracks<br></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static int   </span><span style="color: #660e7a; font-style: italic;">sum_current</span>;       <span style="color: #808080; font-style: italic;">// and its sum<br></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static int   </span><span style="color: #660e7a; font-style: italic;">n_included_tracks</span>; <span style="color: #808080; font-style: italic;">// keeps how many tracks are selected<br></span><span style="color: #808080; font-style: italic;"><br></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static int</span>[] <span style="color: #660e7a; font-style: italic;">best</span>;              <span style="color: #808080; font-style: italic;">// keeps the best solutions found so far<br></span><span style="color: #808080; font-style: italic;">    </span><span style="color: #000080; font-weight: bold;">static int   </span><span style="color: #660e7a; font-style: italic;">sum_best</span>;          <span style="color: #808080; font-style: italic;">// and its sum</span></span></pre>
<p>O backtracking funcionará da seguinte forma: para cada música (<em>track</em>) experimentamos dois casos: incluí-la ou não na solução. Para cada um dos casos, continuamos o <em>backtracking</em> e quando este terminar verificamos se obtivemos uma solução <span style="font-size: small;"><span style="color: #660e7a; font-style: italic;">current</span></span> melhor que a melhor actual <span style="font-size: small;"><span style="color: #660e7a; font-style: italic;">best</span></span>. Se assim for, guardamos a melhor.</p>
<p>Há duas formas de terminar o backtracking: ou deparamos com uma solução inviável (e não incluímos essa música) ou porque já tentamos todas as músicas disponíveis.</p>
<p>O seguinte método realiza este algoritmo:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;"><span style="color: #000080; font-weight: bold;">private static void </span>backtrack(<span style="color: #000080; font-weight: bold;">int </span>track) {</span><br><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">if </span>(track == <span style="color: #660e7a; font-style: italic;">n_tracks</span>) <span style="color: #808080; font-style: italic;">// tested all tracks, end of backtracking<br></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #000080; font-weight: bold;">return</span>;</span><br><br><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">if </span>(<span style="color: #660e7a; font-style: italic;">sum_current </span>+ <span style="color: #660e7a; font-style: italic;">tracks_length</span>[track] &lt;= <span style="color: #660e7a; font-style: italic;">N</span>) {</span><br><span style="font-size: small;">        <span style="color: #808080; font-style: italic;">// it's feasible to add it<br></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #660e7a; font-style: italic;">current</span>[<span style="color: #660e7a; font-style: italic;">n_included_tracks</span>++] = track;</span><br><span style="font-size: small;">        <span style="color: #660e7a; font-style: italic;">sum_current </span>+= <span style="color: #660e7a; font-style: italic;">tracks_length</span>[track];</span><br><br><span style="font-size: small;">        <span style="font-style: italic;">backtrack</span>(track+<span style="color: #0000ff;">1</span>);</span><br><br><span style="font-size: small;">        <span style="color: #000080; font-weight: bold;">if </span>(<span style="color: #660e7a; font-style: italic;">sum_current </span>&gt; <span style="color: #660e7a; font-style: italic;">sum_best</span>) { <span style="color: #808080; font-style: italic;">// found a better one<br></span><span style="color: #808080; font-style: italic;">            </span><span style="color: #660e7a; font-style: italic;">best </span>= <span style="color: #660e7a; font-style: italic;">current</span>.clone();</span><br><span style="font-size: small;">            <span style="color: #660e7a; font-style: italic;">sum_best </span>= <span style="color: #660e7a; font-style: italic;">sum_current</span>;</span><br><span style="font-size: small;">        }</span><br><br><span style="font-size: small;">        <span style="color: #808080; font-style: italic;">// now, remove track to test solution without it<br></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #660e7a; font-style: italic;">sum_current </span>-= <span style="color: #660e7a; font-style: italic;">tracks_length</span>[track];</span><br><span style="font-size: small;">        <span style="color: #660e7a; font-style: italic;">current</span>[--<span style="color: #660e7a; font-style: italic;">n_included_tracks</span>] = <span style="color: #660e7a; font-weight: bold; font-style: italic;">NTA</span>;</span><br><span style="font-size: small;">    }</span><br><br><span style="font-size: small;">    <span style="font-style: italic;">backtrack</span>(track+<span style="color: #0000ff;">1</span>);</span><br><br><span style="font-size: small;">    <span style="color: #000080; font-weight: bold;">if </span>(<span style="color: #660e7a; font-style: italic;">sum_current </span>&gt; <span style="color: #660e7a; font-style: italic;">sum_best</span>) { <span style="color: #808080; font-style: italic;">// found a better one<br></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #660e7a; font-style: italic;">best </span>= <span style="color: #660e7a; font-style: italic;">current</span>.clone();</span><br><span style="font-size: small;">        <span style="color: #660e7a; font-style: italic;">sum_best </span>= <span style="color: #660e7a; font-style: italic;">sum_current</span>;</span><br><span style="font-size: small;">    }</span><br><span style="font-size: small;">}</span></pre>
<p>O resto da classe é a leitura dos dados para cada caso, e a escrita do <em>output</em>:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'Courier New'; margin-left: 30px;"><span style="font-size: small;">   <span style="color: #000080; font-weight: bold;">public static void </span>main(String[] args) {</span><br><span style="font-size: small;">        <span style="color: #000080; font-weight: bold;">if </span>(<span style="color: #0000ff;">1</span>&gt;<span style="color: #0000ff;">0</span>)    <span style="color: #808080; font-style: italic;">// if true: read from files; else: read from System.in<br></span><span style="color: #808080; font-style: italic;">            </span><span style="color: #000080; font-weight: bold;">try </span>{   <span style="color: #808080; font-style: italic;">// redirect System.in and System.out to in/out text files<br></span><span style="color: #808080; font-style: italic;">                </span>System.<span style="font-style: italic;">setIn </span>(<span style="color: #000080; font-weight: bold;">new </span>FileInputStream(<span style="color: #008000; font-weight: bold;">"data/uva624.in.txt" </span>));</span><br><span style="font-size: small;">                System.<span style="font-style: italic;">setOut</span>(<span style="color: #000080; font-weight: bold;">new </span>PrintStream(<span style="color: #008000; font-weight: bold;">"data/uva624.out.txt"</span>) );</span><br><span style="font-size: small;">            } <span style="color: #000080; font-weight: bold;">catch </span>(Exception e) {}</span><br><span style="font-size: small;">        <span style="color: #808080; font-style: italic;">///////////////////////////////////////////////////////////////<br></span><span style="color: #808080; font-style: italic;"><br></span><span style="color: #808080; font-style: italic;">        </span>Scanner sc = <span style="color: #000080; font-weight: bold;">new </span>Scanner(System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">in</span>);</span><br><br><span style="font-size: small;">        <span style="color: #000080; font-weight: bold;">while </span>(sc.hasNextInt()) {              <span style="color: #808080; font-style: italic;">// for each line:<br></span><span style="color: #808080; font-style: italic;"><br></span><span style="color: #808080; font-style: italic;">            // read input<br></span><span style="color: #808080; font-style: italic;">            </span><span style="color: #660e7a; font-style: italic;">N </span>= sc.nextInt();</span><br><span style="font-size: small;">            <span style="color: #660e7a; font-style: italic;">n_tracks </span>= sc.nextInt();</span><br><span style="font-size: small;">            <span style="color: #660e7a; font-style: italic;">tracks_length </span>= <span style="color: #000080; font-weight: bold;">new int</span>[<span style="color: #660e7a; font-style: italic;">n_tracks</span>];</span><br><span style="font-size: small;">            <span style="color: #000080; font-weight: bold;">for</span>(<span style="color: #000080; font-weight: bold;">int </span>i = <span style="color: #0000ff;">0</span>; i&lt; <span style="color: #660e7a; font-style: italic;">n_tracks</span>; i++)</span><br><span style="font-size: small;">                <span style="color: #660e7a; font-style: italic;">tracks_length</span>[i] = sc.nextInt();</span><br><br><span style="font-size: small;">            <span style="color: #808080; font-style: italic;">// init variables used in backtrack<br></span><span style="color: #808080; font-style: italic;">            </span><span style="color: #660e7a; font-style: italic;">current </span>= <span style="color: #000080; font-weight: bold;">new int</span>[<span style="color: #660e7a; font-style: italic;">n_tracks</span>];  <span style="color: #808080; font-style: italic;">// a solution may have all tracks available<br></span><span style="color: #808080; font-style: italic;">            </span><span style="color: #000080; font-weight: bold;">for</span>(<span style="color: #000080; font-weight: bold;">int </span>i = <span style="color: #0000ff;">0</span>; i&lt; <span style="color: #660e7a; font-style: italic;">n_tracks</span>; i++)</span><br><span style="font-size: small;">                <span style="color: #660e7a; font-style: italic;">current</span>[i] = <span style="color: #660e7a; font-weight: bold; font-style: italic;">NTA</span>;</span><br><span style="font-size: small;">            <span style="color: #660e7a; font-style: italic;">n_included_tracks </span>= <span style="color: #660e7a; font-style: italic;">sum_best </span>= <span style="color: #660e7a; font-style: italic;">sum_current </span>= <span style="color: #0000ff;">0</span>;</span><br><br><span style="font-size: small;">            <span style="font-style: italic;">backtrack</span>(<span style="color: #0000ff;">0</span>);</span><br><br><span style="font-size: small;">            <span style="color: #808080; font-style: italic;">// print solution<br></span><span style="color: #808080; font-style: italic;">            </span><span style="color: #000080; font-weight: bold;">for</span>(<span style="color: #000080; font-weight: bold;">int </span>i = <span style="color: #0000ff;">0</span>; i&lt; <span style="color: #660e7a; font-style: italic;">n_tracks </span>&amp;&amp; <span style="color: #660e7a; font-style: italic;">best</span>[i]!=<span style="color: #660e7a; font-weight: bold; font-style: italic;">NTA</span>; i++)</span><br><span style="font-size: small;">                System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.print(<span style="color: #660e7a; font-style: italic;">tracks_length</span>[<span style="color: #660e7a; font-style: italic;">best</span>[i]] + <span style="color: #008000; font-weight: bold;">" "</span>);</span><br><span style="font-size: small;">            System.<span style="color: #660e7a; font-weight: bold; font-style: italic;">out</span>.println(<span style="color: #008000; font-weight: bold;">"sum:" </span>+ <span style="color: #660e7a; font-style: italic;">sum_best</span>);</span><br><span style="font-size: small;">        }</span><br><span style="font-size: small;">    }</span><br><span style="font-size: small;">}</span></pre>
<p>Neste caso, o código como está é aceite no servidor UVa no tempo máximo permitido. Se porventura não fosse o caso, mas estivéssemos muito perto do limite de tempo, poderíamos tentar melhorar a pesquisa de soluções.</p>
<p>Duas sugestões:</p>
<ul>
<li>incluir uma condição para o caso de se obter uma solução óptima (soma igual a N). Neste caso era escusado continuar a pesquisa dado que não se poderia melhorar a solução encontrada</li>
<li>antes da pesquisa fazer uma ordenação das músicas por ordem decrescente de duração. Se começarmos a testar as músicas maiores em primeiro lugar, é mais fácil encontrar soluções parciais inviáveis, e assim fazer <em>backtracking</em> mais cedo. Ao reduzir o espaço de soluções parciais que construímos, o programa pode ficar substancialmente mais rápido.</li>
</ul>
<p></p></div></div><div class="modified">Last modified: Saturday, 11 February 2017, 10:23 AM</div>

</body>
</html>